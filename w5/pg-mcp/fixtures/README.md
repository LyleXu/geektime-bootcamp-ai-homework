# PostgreSQL æµ‹è¯•æ•°æ®åº“ (Test Databases)

æœ¬ç›®å½•åŒ…å«ä¸‰ä¸ªä¸åŒè§„æ¨¡çš„ PostgreSQL æµ‹è¯•æ•°æ®åº“ï¼Œç”¨äº pg-mcp é¡¹ç›®çš„å¼€å‘å’Œæµ‹è¯•ã€‚

## ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ

### 1. å°å‹åšå®¢æ•°æ®åº“ (Small Blog Database)
- **æ–‡ä»¶**: `small_blog.sql`
- **æ•°æ®åº“å**: `blog_small`
- **åœºæ™¯**: ä¸ªäººåšå®¢ç³»ç»Ÿ
- **è§„æ¨¡**:
  - 8 å¼ è¡¨
  - 2 ä¸ªè§†å›¾
  - 2 ä¸ªæšä¸¾ç±»å‹
  - ~20 ä¸ªç´¢å¼•
  - ~500 æ¡è®°å½•
- **ä¸šåŠ¡å¯¹è±¡**:
  - ç”¨æˆ·ã€åˆ†ç±»ã€æ ‡ç­¾
  - æ–‡ç« ã€æ–‡ç« æ ‡ç­¾ã€è¯„è®º
  - é¡µé¢æµè§ˆè®°å½•
- **é€‚ç”¨åœºæ™¯**: 
  - å¿«é€Ÿå¼€å‘æµ‹è¯•
  - åŸºæœ¬åŠŸèƒ½éªŒè¯
  - Schema æŸ¥è¯¢æµ‹è¯•

### 2. ä¸­å‹ç”µå•†æ•°æ®åº“ (Medium E-commerce Database)
- **æ–‡ä»¶**: `medium_ecommerce.sql`
- **æ•°æ®åº“å**: `ecommerce_medium`
- **åœºæ™¯**: ä¸­å°å‹ç”µå•†å¹³å°
- **è§„æ¨¡**:
  - 18 å¼ è¡¨
  - 5 ä¸ªè§†å›¾
  - 4 ä¸ªæšä¸¾ç±»å‹
  - ~40 ä¸ªç´¢å¼•
  - ~5,000 æ¡è®°å½•
- **ä¸šåŠ¡å¯¹è±¡**:
  - ç”¨æˆ·ã€åœ°å€ã€å•†å“åˆ†ç±»ã€å“ç‰Œ
  - å•†å“ã€å•†å“å›¾ç‰‡
  - è®¢å•ã€è®¢å•æ˜ç»†ã€æ”¯ä»˜ã€ç‰©æµ
  - è´­ç‰©è½¦ã€æ”¶è—ã€è¯„ä»·
  - ä¼˜æƒ åˆ¸ã€åº“å­˜æ—¥å¿—
- **é€‚ç”¨åœºæ™¯**:
  - å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
  - å¤æ‚æŸ¥è¯¢æµ‹è¯•
  - å¤šè¡¨å…³è”æŸ¥è¯¢
  - æ€§èƒ½åŸºå‡†æµ‹è¯•

### 3. å¤§å‹ERPæ•°æ®åº“ (Large Enterprise ERP Database)
- **æ–‡ä»¶**: `large_erp.sql`
- **æ•°æ®åº“å**: `erp_large`
- **åœºæ™¯**: ç»¼åˆä¼ä¸šèµ„æºè§„åˆ’ç³»ç»Ÿ
- **è§„æ¨¡**:
  - 35 å¼ è¡¨
  - 8 ä¸ªè§†å›¾
  - 8 ä¸ªæšä¸¾ç±»å‹
  - 70+ ä¸ªç´¢å¼•
  - ~50,000 æ¡è®°å½•
- **ä¸šåŠ¡æ¨¡å—**:
  - **äººåŠ›èµ„æº**: éƒ¨é—¨ã€èŒä½ã€å‘˜å·¥ã€è€ƒå‹¤ã€è¯·å‡
  - **é”€å”®ç®¡ç†**: å®¢æˆ·ã€é”€å”®è®¢å•ã€å‘ç¥¨
  - **é‡‡è´­ç®¡ç†**: ä¾›åº”å•†ã€é‡‡è´­è®¢å•ã€ä¾›åº”å•†è¯„ä»·
  - **åº“å­˜ç®¡ç†**: äº§å“ã€ä»“åº“ã€åº“å­˜ã€åº“å­˜æ—¥å¿—
  - **è´¢åŠ¡ç®¡ç†**: ç§‘ç›®ã€è´¢åŠ¡äº¤æ˜“ã€åº”æ”¶åº”ä»˜è´¦æ¬¾
  - **é¡¹ç›®ç®¡ç†**: é¡¹ç›®ã€ä»»åŠ¡
  - **å…¶ä»–**: è®¾å¤‡èµ„äº§ã€è´¹ç”¨æŠ¥é”€ã€åˆåŒã€æ–‡æ¡£ã€ä¼šè®®å®¤ç­‰
- **é€‚ç”¨åœºæ™¯**:
  - å¤§è§„æ¨¡æ•°æ®æŸ¥è¯¢æµ‹è¯•
  - å¤æ‚ä¸šåŠ¡åœºæ™¯éªŒè¯
  - æ€§èƒ½å‹åŠ›æµ‹è¯•
  - Schema ç¼“å­˜æ€§èƒ½æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

1. å®‰è£… PostgreSQL 15+
2. ç¡®ä¿ `psql` å‘½ä»¤å¯ç”¨ï¼ˆå·²æ·»åŠ åˆ° PATHï¼‰
3. æ‹¥æœ‰åˆ›å»ºæ•°æ®åº“çš„æƒé™

### Windows ç³»ç»Ÿä½¿ç”¨

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ PowerShell è„šæœ¬ï¼ˆæ¨èï¼‰

```powershell
# é‡å»ºæ‰€æœ‰æ•°æ®åº“
.\Rebuild-TestDatabases.ps1 -Database all

# åªé‡å»ºå°å‹æ•°æ®åº“
.\Rebuild-TestDatabases.ps1 -Database small

# åªé‡å»ºä¸­å‹æ•°æ®åº“
.\Rebuild-TestDatabases.ps1 -Database medium

# åªé‡å»ºå¤§å‹æ•°æ®åº“
.\Rebuild-TestDatabases.ps1 -Database large

# æŒ‡å®šæ•°æ®åº“æœåŠ¡å™¨
.\Rebuild-TestDatabases.ps1 -Database all -Host localhost -Port 5432 -User postgres

# å¼ºåˆ¶é‡å»ºï¼Œä¸æç¤ºç¡®è®¤
.\Rebuild-TestDatabases.ps1 -Database medium -ForceRebuild
```

#### PowerShell è„šæœ¬å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ | å¿…éœ€ |
|------|------|--------|------|
| `-Database` | æ•°æ®åº“ç±»å‹ (small/medium/large/all) | - | âœ“ |
| `-Host` | PostgreSQL æœåŠ¡å™¨åœ°å€ | localhost | âœ— |
| `-Port` | PostgreSQL ç«¯å£ | 5432 | âœ— |
| `-User` | PostgreSQL ç”¨æˆ·å | postgres | âœ— |
| `-Password` | PostgreSQL å¯†ç  | (æç¤ºè¾“å…¥) | âœ— |
| `-ForceRebuild` | å¼ºåˆ¶é‡å»ºï¼Œä¸æç¤ºç¡®è®¤ | false | âœ— |

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æ‰§è¡Œ SQL æ–‡ä»¶

```powershell
# å°å‹æ•°æ®åº“
psql -U postgres -d postgres -f small_blog.sql

# ä¸­å‹æ•°æ®åº“  
psql -U postgres -d postgres -f medium_ecommerce.sql

# å¤§å‹æ•°æ®åº“
psql -U postgres -d postgres -f large_erp.sql
```

### Linux/Mac ç³»ç»Ÿä½¿ç”¨

```bash
# å°å‹æ•°æ®åº“
psql -U postgres -d postgres -f small_blog.sql

# ä¸­å‹æ•°æ®åº“
psql -U postgres -d postgres -f medium_ecommerce.sql

# å¤§å‹æ•°æ®åº“
psql -U postgres -d postgres -f large_erp.sql
```

## ğŸ“ æ•°æ®åº“è¯¦ç»†è¯´æ˜

### å°å‹åšå®¢æ•°æ®åº“è¡¨ç»“æ„

```
users (ç”¨æˆ·è¡¨)
â”œâ”€â”€ categories (åˆ†ç±»è¡¨)
â”œâ”€â”€ tags (æ ‡ç­¾è¡¨)
â”œâ”€â”€ posts (æ–‡ç« è¡¨)
â”‚   â”œâ”€â”€ post_tags (æ–‡ç« æ ‡ç­¾å…³è”)
â”‚   â”œâ”€â”€ comments (è¯„è®ºè¡¨)
â”‚   â””â”€â”€ page_views (æµè§ˆè®°å½•)
â””â”€â”€ è§†å›¾
    â”œâ”€â”€ post_stats (æ–‡ç« ç»Ÿè®¡)
    â””â”€â”€ popular_posts (çƒ­é—¨æ–‡ç« )
```

### ä¸­å‹ç”µå•†æ•°æ®åº“è¡¨ç»“æ„

```
users (ç”¨æˆ·è¡¨)
â”œâ”€â”€ addresses (åœ°å€è¡¨)
â”œâ”€â”€ cart_items (è´­ç‰©è½¦)
â”œâ”€â”€ wishlists (æ”¶è—)
â””â”€â”€ reviews (è¯„ä»·)

products (å•†å“è¡¨)
â”œâ”€â”€ categories (åˆ†ç±»)
â”œâ”€â”€ brands (å“ç‰Œ)
â”œâ”€â”€ product_images (å•†å“å›¾ç‰‡)
â””â”€â”€ inventory_logs (åº“å­˜æ—¥å¿—)

orders (è®¢å•è¡¨)
â”œâ”€â”€ order_items (è®¢å•æ˜ç»†)
â”œâ”€â”€ payments (æ”¯ä»˜è®°å½•)
â””â”€â”€ shipments (ç‰©æµè®°å½•)

coupons (ä¼˜æƒ åˆ¸)
â””â”€â”€ user_coupons (ç”¨æˆ·ä¼˜æƒ åˆ¸)

search_history (æœç´¢å†å²)
```

### å¤§å‹ERPæ•°æ®åº“æ¨¡å—ç»“æ„

**ç»„ç»‡æ¶æ„**:
- `departments` (éƒ¨é—¨)
- `positions` (èŒä½)
- `employees` (å‘˜å·¥)

**äººåŠ›èµ„æº**:
- `attendance_records` (è€ƒå‹¤)
- `leave_requests` (è¯·å‡)
- `expense_claims` (æŠ¥é”€)

**å®¢æˆ·ä¸ä¾›åº”å•†**:
- `customers` (å®¢æˆ·)
- `suppliers` (ä¾›åº”å•†)
- `customer_contacts` (å®¢æˆ·è”ç³»è®°å½•)
- `supplier_evaluations` (ä¾›åº”å•†è¯„ä»·)

**äº§å“ä¸åº“å­˜**:
- `product_categories` (äº§å“åˆ†ç±»)
- `products` (äº§å“)
- `warehouses` (ä»“åº“)
- `inventory` (åº“å­˜)

**é”€å”®ä¸é‡‡è´­**:
- `sales_orders` (é”€å”®è®¢å•)
- `sales_order_items` (é”€å”®è®¢å•æ˜ç»†)
- `purchase_orders` (é‡‡è´­è®¢å•)
- `purchase_order_items` (é‡‡è´­è®¢å•æ˜ç»†)

**è´¢åŠ¡ç®¡ç†**:
- `invoices` (å‘ç¥¨)
- `invoice_items` (å‘ç¥¨æ˜ç»†)
- `accounts` (ä¼šè®¡ç§‘ç›®)
- `financial_transactions` (è´¢åŠ¡äº¤æ˜“)

**é¡¹ç›®ç®¡ç†**:
- `projects` (é¡¹ç›®)
- `tasks` (ä»»åŠ¡)

**å…¶ä»–**:
- `equipment` (è®¾å¤‡èµ„äº§)
- `documents` (æ–‡æ¡£)
- `contracts` (åˆåŒ)
- `meeting_rooms` (ä¼šè®®å®¤)
- `meeting_bookings` (ä¼šè®®é¢„è®¢)
- `notifications` (é€šçŸ¥)
- `system_logs` (ç³»ç»Ÿæ—¥å¿—)
- `approval_workflows` (å®¡æ‰¹æµç¨‹)
- `approval_records` (å®¡æ‰¹è®°å½•)

## ğŸ” æ•°æ®ç‰¹ç‚¹

### ä¸­è‹±æ–‡æ··åˆæ•°æ®
æ‰€æœ‰æ•°æ®åº“éƒ½åŒ…å«ä¸­è‹±æ–‡æ··åˆæ•°æ®ï¼Œæµ‹è¯•åŒè¯­æŸ¥è¯¢åœºæ™¯ï¼š
- ç”¨æˆ·åã€äº§å“åã€æè¿°ç­‰å­—æ®µåŒ…å«ä¸­æ–‡å’Œè‹±æ–‡
- é€‚åˆæµ‹è¯•è‡ªç„¶è¯­è¨€æŸ¥è¯¢çš„ä¸­è‹±æ–‡è¯†åˆ«èƒ½åŠ›

### çœŸå®ä¸šåŠ¡å…³ç³»
- å®Œæ•´çš„å¤–é”®çº¦æŸ
- åˆç†çš„æ•°æ®å…³è”
- çœŸå®çš„ä¸šåŠ¡åœºæ™¯

### ä¸°å¯Œçš„Schemaå…ƒç´ 
- è¡¨ (Tables)
- è§†å›¾ (Views)
- ç´¢å¼• (Indexes)
- æšä¸¾ç±»å‹ (Enum Types)
- æ³¨é‡Š (Comments)
- çº¦æŸ (Constraints)
- ç”Ÿæˆåˆ— (Generated Columns)

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

### å°å‹æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

```sql
-- æŸ¥è¯¢æœ€å—æ¬¢è¿çš„æ–‡ç« 
SELECT * FROM popular_posts LIMIT 10;

-- æŸ¥è¯¢æŸä¸ªä½œè€…çš„æ‰€æœ‰å·²å‘å¸ƒæ–‡ç« 
SELECT p.title, p.view_count, p.published_at 
FROM posts p
JOIN users u ON p.author_id = u.id
WHERE u.username = 'alice_wang' AND p.status = 'published'
ORDER BY p.published_at DESC;

-- æŸ¥è¯¢å¸¦æœ‰ç‰¹å®šæ ‡ç­¾çš„æ–‡ç« 
SELECT p.title, t.name 
FROM posts p
JOIN post_tags pt ON p.id = pt.post_id
JOIN tags t ON pt.tag_id = t.id
WHERE t.name = 'Python';
```

### ä¸­å‹æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

```sql
-- æŸ¥è¯¢ç•…é”€å•†å“
SELECT * FROM bestselling_products LIMIT 20;

-- æŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„è®¢å•å†å²
SELECT o.order_no, o.total, o.status, o.created_at
FROM orders o
WHERE o.user_id = 1
ORDER BY o.created_at DESC;

-- æŸ¥è¯¢åº“å­˜ä¸è¶³çš„å•†å“
SELECT * FROM low_stock_products;

-- æŸ¥è¯¢æŸä¸ªåˆ†ç±»ä¸‹çš„æ‰€æœ‰å•†å“
SELECT p.name, p.price, p.stock_quantity, c.name AS category
FROM products p
JOIN categories c ON p.category_id = c.id
WHERE c.slug = 'phones';
```

### å¤§å‹æ•°æ®åº“æŸ¥è¯¢ç¤ºä¾‹

```sql
-- æŸ¥è¯¢å‘˜å·¥è¯¦æƒ…
SELECT * FROM employee_details WHERE department = 'é”€å”®éƒ¨';

-- æŸ¥è¯¢åº“å­˜é¢„è­¦
SELECT * FROM inventory_alerts WHERE alert_level = 'critical';

-- æŸ¥è¯¢é”€å”®ç»Ÿè®¡
SELECT * FROM sales_statistics WHERE status = 'delivered';

-- æŸ¥è¯¢åº”æ”¶è´¦æ¬¾
SELECT * FROM accounts_receivable WHERE aging_status = 'overdue';

-- æŸ¥è¯¢é¡¹ç›®è¿›åº¦
SELECT * FROM project_progress WHERE completion_percentage < 50;

-- æŸ¥çœ‹æŸä¸ªéƒ¨é—¨çš„ç»„ç»‡æ¶æ„
WITH RECURSIVE dept_tree AS (
    SELECT id, name, parent_id, 0 AS level
    FROM departments
    WHERE code = 'SALES'
    UNION ALL
    SELECT d.id, d.name, d.parent_id, dt.level + 1
    FROM departments d
    JOIN dept_tree dt ON d.parent_id = dt.id
)
SELECT * FROM dept_tree;
```

## ğŸ”§ ç»´æŠ¤å’Œæ›´æ–°

### é‡æ–°ç”Ÿæˆæ•°æ®

å¦‚æœéœ€è¦ä¿®æ”¹æ•°æ®æˆ–é‡æ–°ç”Ÿæˆï¼Œç›´æ¥ç¼–è¾‘å¯¹åº”çš„ SQL æ–‡ä»¶ï¼Œç„¶åé‡æ–°è¿è¡Œé‡å»ºè„šæœ¬ã€‚

### æ·»åŠ è‡ªå®šä¹‰æ•°æ®

å¯ä»¥åœ¨é‡å»ºåè¿æ¥åˆ°æ•°æ®åº“æ‰‹åŠ¨æ·»åŠ æ•°æ®ï¼š

```sql
-- è¿æ¥åˆ°æ•°æ®åº“
\c blog_small

-- æ’å…¥è‡ªå®šä¹‰æ•°æ®
INSERT INTO users (username, email, password_hash, full_name) 
VALUES ('test_user', 'test@example.com', '$2b$12$test', 'Test User');
```

### å¤‡ä»½æ•°æ®åº“

```bash
# å¤‡ä»½å°å‹æ•°æ®åº“
pg_dump -U postgres -d blog_small -f blog_small_backup.sql

# å¤‡ä»½ä¸­å‹æ•°æ®åº“
pg_dump -U postgres -d ecommerce_medium -f ecommerce_medium_backup.sql

# å¤‡ä»½å¤§å‹æ•°æ®åº“
pg_dump -U postgres -d erp_large -f erp_large_backup.sql
```

## ğŸ“Š æ€§èƒ½åŸºå‡†

### é¢„æœŸæ‰§è¡Œæ—¶é—´ï¼ˆå‚è€ƒï¼‰

| æ•°æ®åº“ | é‡å»ºæ—¶é—´ | æ•°æ®åº“å¤§å° |
|--------|---------|-----------|
| Small Blog | ~2-5 ç§’ | ~5 MB |
| Medium E-commerce | ~10-20 ç§’ | ~30 MB |
| Large ERP | ~30-60 ç§’ | ~150 MB |

*æ³¨: å®é™…æ—¶é—´å–å†³äºç¡¬ä»¶é…ç½®å’ŒPostgreSQLç‰ˆæœ¬*

### æŸ¥è¯¢æ€§èƒ½æµ‹è¯•

```sql
-- æµ‹è¯•ç®€å•æŸ¥è¯¢
EXPLAIN ANALYZE SELECT * FROM products WHERE is_active = TRUE;

-- æµ‹è¯•å¤æ‚è”æ¥
EXPLAIN ANALYZE 
SELECT p.name, c.name, COUNT(oi.id) 
FROM products p
JOIN categories c ON p.category_id = c.id
LEFT JOIN order_items oi ON p.id = oi.product_id
GROUP BY p.id, c.name;

-- æµ‹è¯•èšåˆæŸ¥è¯¢
EXPLAIN ANALYZE SELECT * FROM sales_statistics;
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### é—®é¢˜: psql å‘½ä»¤æœªæ‰¾åˆ°

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ PostgreSQL å·²æ­£ç¡®å®‰è£…
- å°† PostgreSQL çš„ bin ç›®å½•æ·»åŠ åˆ° PATH ç¯å¢ƒå˜é‡
- Windows: é€šå¸¸åœ¨ `C:\Program Files\PostgreSQL\15\bin`

### é—®é¢˜: å¯†ç è®¤è¯å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ `pg_hba.conf` æ–‡ä»¶ä¸­çš„è®¤è¯æ–¹å¼
- å°è¯•é‡ç½® postgres ç”¨æˆ·å¯†ç 

### é—®é¢˜: æ•°æ®åº“å·²å­˜åœ¨é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
- SQL æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤å·²å­˜åœ¨çš„æ•°æ®åº“
- å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ‰‹åŠ¨åˆ é™¤: `DROP DATABASE IF EXISTS database_name;`
- ç¡®ä¿æ²¡æœ‰å…¶ä»–è¿æ¥å ç”¨æ•°æ®åº“

### é—®é¢˜: æƒé™ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿ç”¨æˆ·æœ‰åˆ›å»ºæ•°æ®åº“çš„æƒé™
- ä½¿ç”¨è¶…çº§ç”¨æˆ·ï¼ˆå¦‚ postgresï¼‰æ‰§è¡Œ
- æˆäºˆæƒé™: `ALTER USER username CREATEDB;`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PostgreSQL å®˜æ–¹æ–‡æ¡£](https://www.postgresql.org/docs/)
- [pg-mcp é¡¹ç›® README](../README.md)
- [pg-mcp è®¾è®¡æ–‡æ¡£](../../specs/w5/0002-pg-mcp-design.md)
- [pg-mcp æµ‹è¯•è®¡åˆ’](../../specs/w5/0007-pg-mcp-test-plan.md)

## ğŸ“„ è®¸å¯è¯

æœ¬æµ‹è¯•æ•°æ®åº“æ–‡ä»¶éµå¾ª pg-mcp é¡¹ç›®çš„è®¸å¯è¯ã€‚

## ğŸ¤ è´¡çŒ®

å¦‚æœæ‚¨å‘ç°æ•°æ®æœ‰é—®é¢˜æˆ–æƒ³æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚

---

**æœ€åæ›´æ–°**: 2026-02-12  
**ç»´æŠ¤è€…**: pg-mcp å¼€å‘å›¢é˜Ÿ
